<div class="page-container">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">Guest List</h1>
            <p class="page-subtitle">Manage guest.</p>
        </div>
        <button class="btn-action btn-export" routerLink="/guests/new">
            Add Guest
        </button>
    </div>

    <!-- Sticky Filter Bar -->
    <div class="filters-bar-wrapper">
        <div class="filters-bar">
            <div class="search-input">
                <mat-icon class="icon">search</mat-icon>
                <input type="text" [ngModel]="searchQuery()" (ngModelChange)="searchQuery.set($event)"
                    placeholder="Search by name or email..." />
            </div>

            <div class="filter-group">
                <select [ngModel]="selectedGroup()" (ngModelChange)="selectedGroup.set($event)" class="filter-select">
                    <option value="all">All Groups</option>
                    <option value="vip">VIP</option>
                    <option value="family">Family</option>
                    <option value="friends">Friends</option>
                    <option value="colleagues">Colleagues</option>
                    <option value="speaker">Speaker</option>
                    <option value="sponsor">Sponsor</option>
                    <option value="media">Media</option>
                    <option value="attendee">Attendee</option>
                </select>

                <select [ngModel]="selectedStatus()" (ngModelChange)="selectedStatus.set($event)" class="filter-select">
                    <option value="all">All Statuses</option>
                    <option value="confirmed">Confirmed</option>
                    <option value="pending">Pending</option>
                    <option value="declined">Declined</option>
                </select>
            </div>

            <div class="view-toggles">
                <button class="icon-btn" [class.active]="viewMode() === 'table'" (click)="toggleView('table')"
                    title="Table View">
                    <mat-icon>table_chart</mat-icon>
                </button>
                <button class="icon-btn" [class.active]="viewMode() === 'card'" (click)="toggleView('card')"
                    title="Card View">
                    <mat-icon>grid_view</mat-icon>
                </button>
            </div>
        </div>

        <!-- Bulk Actions Bar -->
        <div class="bulk-actions-bar" *ngIf="selectedGuests().size > 0">
            <span class="selection-count">{{ selectedGuests().size }} SELECTED</span>
            <div class="actions">
                <button class="action-btn danger" (click)="deleteSelected()">
                    <mat-icon>delete</mat-icon> Delete
                </button>
                <button class="action-btn" (click)="selectedGuests().clear()">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Table View -->
    <div class="content-area" *ngIf="viewMode() === 'table'">
        <app-data-table [data]="filteredGuests()" [columns]="tableColumns" [actions]="tableActions" [selectable]="true"
            [pageSize]="pageSize()" (action)="handleTableAction($event)"
            (selectionChange)="handleSelectionChange($event)">
        </app-data-table>
    </div>

    <!-- Card View -->
    <div class="content-area" *ngIf="viewMode() === 'card'">
        <div class="guests-grid">
            <div class="guest-card" *ngFor="let guest of paginatedCardGuests()">
                <div class="card-header">
                    <div class="avatar-lg">
                        {{ guest.firstName[0] }}{{ guest.lastName[0] }}
                    </div>
                    <div class="actions">
                        <button class="icon-btn" (click)="editGuest(guest)" title="Edit guest">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button class="icon-btn danger" (click)="deleteGuest(guest)" title="Delete guest">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <h3 class="name">{{ guest.firstName }} {{ guest.lastName }}</h3>
                    <p class="email">{{ guest.email }}</p>
                    <p class="phone">{{ guest.phone || 'No phone' }}</p>
                    <div class="badges">
                        <span class="badge group">{{ guest.group }}</span>
                        <span class="badge status" [class]="guest.status">{{ guest.status }}</span>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredGuests().length === 0" class="empty-state">No guests match your filters.</div>
        </div>

    </div>

    <!-- Shared Pagination Controls -->
    <div class="pagination" *ngIf="totalPages() > 1">
        <span class="page-info">
            Showing {{ currentPage() * pageSize() + 1 }}-{{ Math.min((currentPage() + 1) * pageSize(), totalItems()) }}
            of {{ totalItems() }}
        </span>
        <div class="page-controls">
            <button class="icon-btn" [disabled]="currentPage() === 0" (click)="prevPage()">
                <mat-icon>chevron_left</mat-icon>
            </button>
            <span class="page-number">Page {{ currentPage() + 1 }}</span>
            <button class="icon-btn" [disabled]="currentPage() === totalPages() - 1" (click)="nextPage()">
                <mat-icon>chevron_right</mat-icon>
            </button>
        </div>
    </div>
</div>