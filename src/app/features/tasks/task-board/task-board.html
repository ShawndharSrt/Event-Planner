<div class="page-container">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">Task Board</h1>
            <p class="page-subtitle">Track progress and manage event tasks</p>
        </div>
        <div class="event-selector">
            <select [ngModel]="selectedEventId()" (change)="onEventChange($event)">
                <option *ngFor="let event of events()" [value]="event.id">{{ event.title }}</option>
            </select>
        </div>
        <button class="create-btn" (click)="addTask()">
            <span class="icon">+</span>
            Add Task
        </button>
    </div>

    <div class="board-container" cdkDropListGroup>
        <!-- To Do Column -->
        <div class="board-column">
            <div class="column-header">
                <h3 class="title">To Do</h3>
                <span class="count">{{ todoTasks().length }}</span>
            </div>
            <div class="column-content" cdkDropList id="todo-column" [cdkDropListData]="todoTasks()"
                (cdkDropListDropped)="drop($event)">
                <div class="task-card" *ngFor="let task of todoTasks()" cdkDrag>
                    <div class="task-header">
                        <span class="priority" [ngClass]="task.priority">{{ task.priority | titlecase }}</span>
                        <div class="header-actions">
                            <button class="icon-btn edit-btn" (click)="editTask(task); $event.stopPropagation()"
                                title="Edit task">
                                <span class="material-icons">edit</span>
                            </button>
                            <button class="icon-btn delete-btn" (click)="deleteTask(task); $event.stopPropagation()"
                                title="Delete task">
                                <span class="material-icons">delete</span>
                            </button>
                            <span class="drag-handle" cdkDragHandle>
                                <span class="material-icons">drag_handle</span>
                            </span>
                            <button class="more-btn" (click)="moveTask(task); $event.stopPropagation()">→</button>
                        </div>
                    </div>
                    <div class="event-id">Event ID: {{ task.eventId }}</div>
                    <h4 class="task-title">{{ task.title }}</h4>
                    <p class="task-desc">{{ task.description }}</p>
                    <div class="task-footer">
                        <div class="assignee" [class.secondary]="task.assignee === 'AS'"
                            [class.warning]="task.assignee === 'MJ'">{{ task.assignee }}</div>
                        <span class="due-date" [class.warning]="task.dueDate?.includes('Nov')">{{ task.dueDate }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- In Progress Column -->
        <div class="board-column">
            <div class="column-header">
                <h3 class="title">In Progress</h3>
                <span class="count">{{ inProgressTasks().length }}</span>
            </div>
            <div class="column-content" cdkDropList id="in-progress-column" [cdkDropListData]="inProgressTasks()"
                (cdkDropListDropped)="drop($event)">
                <div class="task-card" *ngFor="let task of inProgressTasks()" cdkDrag>
                    <div class="task-header">
                        <span class="priority" [ngClass]="task.priority">{{ task.priority | titlecase }}</span>
                        <div class="header-actions">
                            <button class="icon-btn edit-btn" (click)="editTask(task); $event.stopPropagation()"
                                title="Edit task">
                                <span class="material-icons">edit</span>
                            </button>
                            <button class="icon-btn delete-btn" (click)="deleteTask(task); $event.stopPropagation()"
                                title="Delete task">
                                <span class="material-icons">delete</span>
                            </button>
                            <span class="drag-handle" cdkDragHandle>
                                <span class="material-icons">drag_handle</span>
                            </span>
                            <button class="more-btn" (click)="moveTask(task); $event.stopPropagation()">→</button>
                        </div>
                    </div>
                    <h4 class="task-title">{{ task.title }}</h4>
                    <p class="task-desc">{{ task.description }}</p>
                    <div class="task-footer">
                        <div class="assignee" [class.secondary]="task.assignee === 'AS'">{{ task.assignee }}</div>
                        <span class="due-date">{{ task.dueDate }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Done Column -->
        <div class="board-column">
            <div class="column-header">
                <h3 class="title">Done</h3>
                <span class="count">{{ doneTasks().length }}</span>
            </div>
            <div class="column-content" cdkDropList id="done-column" [cdkDropListData]="doneTasks()"
                (cdkDropListDropped)="drop($event)">
                <div class="task-card completed" *ngFor="let task of doneTasks()" cdkDrag>
                    <div class="task-header">
                        <span class="priority" [ngClass]="task.priority">{{ task.priority | titlecase }}</span>
                        <div class="header-actions">
                            <button class="icon-btn edit-btn" (click)="editTask(task); $event.stopPropagation()"
                                title="Edit task">
                                <span class="material-icons">edit</span>
                            </button>
                            <button class="icon-btn delete-btn" (click)="deleteTask(task); $event.stopPropagation()"
                                title="Delete task">
                                <span class="material-icons">delete</span>
                            </button>
                            <span class="drag-handle" cdkDragHandle>
                                <span class="material-icons">drag_handle</span>
                            </span>
                            <button class="more-btn" (click)="moveTask(task); $event.stopPropagation()">↺</button>
                        </div>
                    </div>
                    <h4 class="task-title">{{ task.title }}</h4>
                    <p class="task-desc">{{ task.description }}</p>
                    <div class="task-footer">
                        <div class="assignee">{{ task.assignee }}</div>
                        <span class="due-date success">Done</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Task Modal -->
<div class="modal-overlay" *ngIf="showTaskForm()">
    <div class="modal-content">
        <div class="modal-header">
            <h2>{{ editingTask() ? 'Edit Task' : 'Add New Task' }}</h2>
            <button class="close-btn" (click)="cancelTask()">×</button>
        </div>
        <form [formGroup]="form" (ngSubmit)="saveTask()">
            <div class="form-group">
                <label>Title</label>
                <input type="text" formControlName="title" placeholder="Task title">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea formControlName="description" rows="3" placeholder="Task description"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Assignee</label>
                    <select formControlName="assignee">
                        <option value="Me">Me</option>
                        <option value="AS">Alice Smith</option>
                        <option value="MJ">Michael Johnson</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" formControlName="dueDate">
                </div>
            </div>
            <div class="form-group">
                <label>Priority</label>
                <div class="priority-options">
                    <label class="radio-label">
                        <input type="radio" formControlName="priority" value="low">
                        <span class="priority-badge low">Low</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" formControlName="priority" value="medium">
                        <span class="priority-badge medium">Medium</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" formControlName="priority" value="high">
                        <span class="priority-badge high">High</span>
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-cancel" (click)="cancelTask()">Cancel</button>
                <button type="submit" class="btn-save" [disabled]="form.invalid">{{ editingTask() ? 'Save Changes' :
                    'Add Task' }}</button>
            </div>
        </form>
    </div>
</div>